<div class="cart-drawer-content p-3 d-flex flex-column h-100 bg-light">
  <header class="d-flex justify-content-between align-items-center mb-4">
    <div class="d-flex align-items-center gap-3">
      <fa-icon [icon]="faShoppingBag" class="cart-icon"></fa-icon>
      <h2 class="h5 m-0">{{ 'cart.yourCart' | translate }}</h2>
    </div>
    <button mat-icon-button (click)="closeCart()" [attr.aria-label]="'cart.closeCart' | translate">
      <fa-icon [icon]="faClose"></fa-icon>
    </button>
  </header>

  <div class="cart-items-container" #cartItemsContainer>

    <ng-container *ngIf="cartItems$ | async as items; else emptyCart">
      <div *ngIf="items.length > 0; else emptyCart" class="d-flex flex-column gap-3">
        <div *ngFor="let item of items; trackBy: trackByCartItemId" class="cart-item">
          <app-cart-product
            [product]="item.product"
            [productQty]="item.quantity"
            [productStock]="item.originalStock"
            (quantityChange)="handleQuantityChange($event)"
            (removeItem)="handleRemoveItem($event.toString())">
            <!-- Pass other relevant item details if app-cart-product needs them, e.g., selected variations -->
          </app-cart-product>
        </div>
      </div>
    </ng-container>
    <ng-template #emptyCart>
      <div class="text-center d-flex flex-column h-100">
        <fa-icon [icon]="faShoppingCart" size="3x" class="text-muted mb-3"></fa-icon> <!-- Example icon -->
        <p class="text-muted">{{ 'cart.emptyMessage' | translate }}</p>
        <button mat-stroked-button color="primary" (click)="closeCartAndNavigateToShop()">
          {{ 'cart.continueShopping' | translate }}
        </button>
      </div>
    </ng-template>
  </div>

  <footer class="d-flex flex-column gap-3 mt-5" *ngIf="(cartItems$ | async)?.length">
    <div class="d-flex justify-content-between fw-bold">
      <span>{{ 'cart.total' | translate }}</span>
      <span>{{ (totalAmount$ | async) || 0 }} LE</span>
    </div>
    <button class="w-100 btn btn-main-primary text-white py-2" (click)="proceedToCheckout()">
      {{ 'cart.proceedToCheckout' | translate }}
    </button>
    <button class="w-100 btn btn-outline-main-primary py-2" (click)="proceedToCart()">
      {{ 'cart.viewCart' | translate }}
    </button>
  </footer>
</div>
